<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>CyberMonitor 管理后台</title>
    <link rel="icon" id="site-icon" />
    <link rel="stylesheet" href="/assets/styles.css" />
  </head>
  <body>
    <div class="bg-orb orb-a"></div>
    <div class="bg-orb orb-b"></div>
    <div class="bg-orb orb-c"></div>

    <div class="app admin">
      <header class="topbar">
        <div>
          <a class="brand brand-link" href="/">CyberMonitor</a>
          <div class="subtitle">管理后台</div>
        </div>
        <div class="topbar-right">
          <button class="theme-toggle" id="theme-toggle" type="button" aria-label="切换主题">
            <span class="theme-icon" id="theme-icon" aria-hidden="true">🌞</span>
          </button>
        </div>
      </header>

      <section id="login-panel" class="panel login-panel">
        <div class="login-shell">
          <div class="login-intro">
            <span class="login-badge">CyberMonitor Admin Console</span>
            <h2>管理员登录</h2>
            <p class="login-subtitle">进入核心配置区，管理节点、告警与 API 提供商。</p>
            <div class="login-feature-list">
              <div class="login-feature">
                <strong>节点拓扑</strong>
                <span>统一管理分组与探测策略</span>
              </div>
              <div class="login-feature">
                <strong>告警策略</strong>
                <span>精准通知与离线恢复追踪</span>
              </div>
              <div class="login-feature">
                <strong>控制中枢</strong>
                <span>集中管理配置与安全入口</span>
              </div>
            </div>
            <div class="login-note">请使用管理员账号登录，谨慎操作。</div>
          </div>
          <div class="login-card">
            <form id="login-form" class="form-grid login-form">
              <label class="field">
                <span>用户名</span>
                <input class="input" type="text" name="username" autocomplete="username" required />
              </label>
              <label class="field">
                <span>密码</span>
                <input class="input" type="password" name="password" autocomplete="current-password" required />
              </label>
              <button class="btn" type="submit">登录</button>
              <div id="login-error" class="form-hint error"></div>
            </form>
          </div>
        </div>
      </section>

      <section id="admin-shell" class="admin-shell hidden">
        <aside class="side-nav">
          <button class="side-link active" type="button" data-section="settings">基础设置</button>
          <button class="side-link" type="button" data-section="groups">分组管理</button>
          <button class="side-link" type="button" data-section="tests">探测设置</button>
          <button class="side-link" type="button" data-section="agents">服务器管理</button>
          <button class="side-link" type="button" data-section="alerts">通知告警</button>
          <button class="side-link" type="button" data-section="ai">API提供商</button>
          <button class="side-link side-logout hidden" type="button" id="logout-link">退出登录</button>
        </aside>

        <main class="admin-main">
          <section class="panel" data-section="settings">
            <div class="panel-head">
              <div>
                <h2>基础设置</h2>
                <p class="panel-desc">修改后台路径与管理员账号，密码留空则不修改。</p>
              </div>
              <div class="panel-actions">
                <button class="btn small" id="save-settings-btn" type="button">保存</button>
                <div class="form-hint" id="settings-hint"></div>
              </div>
            </div>
            <div class="settings-grid">
              <div class="settings-card">
                <div class="settings-card-head">
                  <h3>账号与入口</h3>
                  <p class="panel-desc">管理后台入口与管理员信息，密码留空则不修改。</p>
                </div>
                <div class="settings-fields">
                  <label class="field">
                    <span>后台路径</span>
                    <input class="input" type="text" id="admin-path" placeholder="/随机路径" />
                  </label>
                  <label class="field">
                    <span>管理员账号</span>
                    <input class="input" type="text" id="admin-user" placeholder="admin" />
                  </label>
                  <label class="field">
                    <span>新密码</span>
                    <input class="input" type="password" id="admin-pass" placeholder="留空不修改" />
                  </label>
                </div>
              </div>
              <div class="settings-card">
                <div class="settings-card-head">
                  <h3>登录保护</h3>
                  <p class="panel-desc">限制异常尝试并降低爆破风险。</p>
                </div>
                <div class="settings-fields">
                  <label class="field">
                    <span>失败次数上限</span>
                    <input class="input" type="number" min="0" step="1" id="login-fail-limit" placeholder="5" />
                    <div class="form-hint">设置为 0 表示不限制。</div>
                  </label>
                  <label class="field">
                    <span>统计窗口(分钟)</span>
                    <input class="input" type="number" min="1" step="1" id="login-fail-window" placeholder="15" />
                  </label>
                  <label class="field">
                    <span>锁定时长(分钟)</span>
                    <input class="input" type="number" min="1" step="1" id="login-lock-minutes" placeholder="15" />
                  </label>
                </div>
              </div>
              <div class="settings-card">
                <div class="settings-card-head">
                  <h3>Agent 接入</h3>
                  <p class="panel-desc">控制 Agent 上报的服务地址。</p>
                </div>
                <div class="settings-fields">
                  <label class="field">
                    <span>Agent 对接地址</span>
                    <input class="input" type="text" id="agent-endpoint" placeholder="https://agent.example.com" />
                  </label>
                </div>
              </div>
              <div class="settings-card">
                <div class="settings-card-head">
                  <h3>站点展示</h3>
                  <p class="panel-desc">前台与浏览器展示文案。</p>
                </div>
                <div class="settings-fields">
                  <label class="field">
                    <span>站点 Title</span>
                    <input class="input" type="text" id="site-title" placeholder="浏览器标题" />
                  </label>
                  <label class="field">
                    <span>站点 Icon</span>
                    <input class="input" type="text" id="site-icon-input" placeholder="图标 URL 或路径" />
                  </label>
                  <label class="field">
                    <span>首页标题</span>
                    <input class="input" type="text" id="home-title" placeholder="首页主标题" />
                  </label>
                  <label class="field">
                    <span>首页副标题</span>
                    <input class="input" type="text" id="home-subtitle" placeholder="首页副标题" />
                  </label>
                </div>
              </div>
            </div>
          </section>

          <section class="panel hidden" data-section="groups">
            <div class="panel-head">
              <div>
                <h2>分组管理</h2>
                <p class="panel-desc">配置分组与标签，标签用于前台分组内展示。</p>
              </div>
              <div class="panel-actions">
                <button class="btn ghost small" id="add-group-btn" type="button">添加分组</button>
                <button class="btn small" id="save-group-btn" type="button">保存</button>
                <div class="form-hint" id="group-hint"></div>
              </div>
            </div>
            <div class="group-tree" id="group-tree"></div>
          </section>

          <section class="panel hidden" data-section="tests">
            <div class="panel-head">
              <div>
                <h2>探测设置</h2>
                <p class="panel-desc">统一维护 ICMP/TCP 目标与默认间隔，节点配置时直接选择。</p>
              </div>
              <div class="panel-actions">
                <button class="btn ghost small" id="add-test-btn" type="button">添加测试节点</button>
                <button class="btn small" id="save-tests-btn" type="button">保存</button>
                <div class="form-hint" id="catalog-hint"></div>
              </div>
            </div>
            <div class="test-catalog-list" id="test-catalog-list"></div>
          </section>

          <section class="panel hidden" data-section="agents">
            <div class="panel-head">
              <div>
                <h2>服务器管理</h2>
                <p class="panel-desc">配置别名、分组、地区与到期策略。</p>
              </div>
              <div class="panel-actions">
                <button class="btn ghost" id="refresh-btn" type="button">刷新</button>
              </div>
            </div>
            <div class="install-card">
              <div class="install-head">
                <h3>快速安装 Agent</h3>
                <p class="panel-desc">在目标服务器执行以下命令后按提示完成安装。</p>
              </div>
              <div class="install-tabs">
                <button class="install-tab active" type="button" data-install-tab="linux">Linux / macOS</button>
                <button class="install-tab" type="button" data-install-tab="windows">Windows</button>
              </div>
              <div class="install-pane active" data-install-pane="linux">
                <pre class="install-code" id="install-linux"></pre>
              </div>
              <div class="install-pane" data-install-pane="windows">
                <pre class="install-code" id="install-windows"></pre>
              </div>
            </div>
            <div id="node-list" class="node-admin-list"></div>
            <div id="admin-empty" class="empty hidden">
              <h2>暂无节点</h2>
              <p>请先启动 Agent 并完成上报。</p>
            </div>
          </section>

          <section class="panel hidden" data-section="alerts">
            <div class="panel-head">
              <div>
                <h2>通知告警</h2>
                <p class="panel-desc">配置飞书或 Telegram 机器人，服务器离线后自动推送提醒。</p>
              </div>
              <div class="panel-actions">
                <button class="btn small" id="save-alerts-btn" type="button">保存</button>
                <button class="btn ghost" id="test-alerts-btn" type="button">测试</button>
                <div class="form-hint" id="alerts-hint"></div>
              </div>
            </div>
            <div class="alert-grid">
              <div class="alert-card">
                <div class="alert-card-head">
                  <div>
                    <h3>告警通道</h3>
                    <p>飞书与 Telegram 告警配置</p>
                  </div>
                </div>
                <div class="alert-fields">
                  <label class="field span-full">
                    <span>飞书 Webhook</span>
                    <input class="input" type="text" id="alert-webhook" placeholder="https://open.feishu.cn/open-apis/bot/v2/hook/..." />
                  </label>
                  <label class="field span-full">
                    <span>Telegram Bot Token</span>
                    <input class="input" type="text" id="alert-telegram-token" placeholder="123456:ABC-DEF..." />
                    <div class="form-hint">启用 Telegram 告警需同时填写 Token 与用户 ID</div>
                  </label>
                  <label class="field">
                    <span>Telegram 用户 ID（逗号分隔）</span>
                    <input class="input" type="text" id="alert-telegram-user-id" placeholder="123456789,987654321" />
                  </label>
                  <label class="field">
                    <span>离线时长(分钟)</span>
                    <input class="input" type="number" id="alert-offline-minutes" min="1" step="1" placeholder="默认 5" />
                  </label>
                  <div class="field span-full">
                    <span>监测说明</span>
                    <div class="form-hint">离线告警开关请在「服务器管理」中按节点设置</div>
                  </div>
                </div>
              </div>

              <div class="alert-card">
                <div class="alert-card-head">
                  <div>
                    <h3>AI 运维</h3>
                    <p>Telegram /ai 使用指定提供商与 Prompt</p>
                  </div>
                </div>
                <div class="alert-fields">
                  <label class="field span-full">
                    <span>指定 AI 提供商</span>
                    <select class="input" id="alert-ai-provider">
                      <option value="openai">OpenAI</option>
                      <option value="gemini">Gemini</option>
                      <option value="volcengine">Volcengine</option>
                    </select>
                  </label>
                  <label class="field span-full">
                    <span>Prompt</span>
                    <textarea class="textarea" id="alert-ai-prompt" placeholder="例如：请重点关注网络流量、下载量与离线情况"></textarea>
                    <div class="form-hint">该提示词会与系统提示合并，用于 /ai 查询</div>
                  </label>
                </div>
              </div>
            </div>
          </section>

          <section class="panel hidden" data-section="ai">
            <div class="panel-head">
              <div>
                <h2>API提供商</h2>
                <p class="panel-desc">配置 AI 提供商后，Telegram 可通过 /ai 命令进行智能运维查询。</p>
              </div>
              <div class="panel-actions">
                <button class="btn small" id="save-ai-btn" type="button">保存</button>
                <div class="form-hint" id="ai-hint"></div>
              </div>
            </div>
            <div class="ai-grid">
              <details class="ai-card" data-provider="openai">
                <summary class="ai-card-head">
                  <div>
                    <h3>OpenAI</h3>
                    <p>官方接口，默认模型 gpt-5.2</p>
                  </div>
                  <span class="ai-card-toggle" aria-hidden="true"></span>
                </summary>
                <div class="ai-fields">
                  <label class="field">
                    <span>API Key</span>
                    <input class="input" type="password" id="ai-openai-key" autocomplete="new-password" placeholder="sk-..." />
                  </label>
                  <label class="field">
                    <span>Base URL</span>
                    <input class="input" type="text" id="ai-openai-base" placeholder="https://api.openai.com/v1" />
                  </label>
                  <label class="field">
                    <span>模型</span>
                    <div class="model-picker" data-model-picker="openai">
                      <input class="input" type="text" id="ai-openai-model" placeholder="gpt-5.2" autocomplete="off" />
                      <div class="model-dropdown" data-model-dropdown="openai"></div>
                    </div>
                    <div class="form-hint">支持手动输入或从“获取可用模型”中选择</div>
                  </label>
                </div>
                <div class="ai-actions">
                  <button class="btn ghost tiny" type="button" data-action="ai-models" data-provider="openai">获取可用模型</button>
                  <button class="btn ghost tiny" type="button" data-action="ai-test" data-provider="openai">测试连接</button>
                </div>
                <div class="ai-hints">
                  <div class="form-hint" data-ai-hint="openai"></div>
                  <div class="form-hint" data-ai-models="openai"></div>
                </div>
              </details>

              <details class="ai-card" data-provider="gemini">
                <summary class="ai-card-head">
                  <div>
                    <h3>Gemini</h3>
                    <p>Google 生成式语言 API</p>
                  </div>
                  <span class="ai-card-toggle" aria-hidden="true"></span>
                </summary>
                <div class="ai-fields">
                  <label class="field">
                    <span>API Key</span>
                    <input class="input" type="password" id="ai-gemini-key" autocomplete="new-password" placeholder="AIza..." />
                  </label>
                  <label class="field">
                    <span>Base URL</span>
                    <input class="input" type="text" id="ai-gemini-base" placeholder="https://generativelanguage.googleapis.com/v1beta" />
                  </label>
                  <label class="field">
                    <span>模型</span>
                    <div class="model-picker" data-model-picker="gemini">
                      <input class="input" type="text" id="ai-gemini-model" placeholder="gemini-2.5-flash" autocomplete="off" />
                      <div class="model-dropdown" data-model-dropdown="gemini"></div>
                    </div>
                    <div class="form-hint">支持手动输入或从“获取可用模型”中选择</div>
                  </label>
                </div>
                <div class="ai-actions">
                  <button class="btn ghost tiny" type="button" data-action="ai-models" data-provider="gemini">获取可用模型</button>
                  <button class="btn ghost tiny" type="button" data-action="ai-test" data-provider="gemini">测试连接</button>
                </div>
                <div class="ai-hints">
                  <div class="form-hint" data-ai-hint="gemini"></div>
                  <div class="form-hint" data-ai-models="gemini"></div>
                </div>
              </details>

              <details class="ai-card" data-provider="volcengine">
                <summary class="ai-card-head">
                  <div>
                    <h3>Volcengine</h3>
                    <p>豆包模型，默认 doubao-seed-1-6-flash</p>
                  </div>
                  <span class="ai-card-toggle" aria-hidden="true"></span>
                </summary>
                <div class="ai-fields">
                  <label class="field">
                    <span>API Key</span>
                    <input class="input" type="password" id="ai-volc-key" autocomplete="new-password" placeholder="volc-..." />
                  </label>
                  <label class="field">
                    <span>Base URL</span>
                    <input class="input" type="text" id="ai-volc-base" placeholder="https://ark.cn-beijing.volces.com/api/v3" />
                  </label>
                  <label class="field">
                    <span>模型</span>
                    <div class="model-picker" data-model-picker="volcengine">
                      <input class="input" type="text" id="ai-volc-model" placeholder="doubao-seed-1-6-flash" autocomplete="off" />
                      <div class="model-dropdown" data-model-dropdown="volcengine"></div>
                    </div>
                    <div class="form-hint">支持手动输入或从“获取可用模型”中选择</div>
                  </label>
                </div>
                <div class="ai-actions">
                  <button class="btn ghost tiny" type="button" data-action="ai-models" data-provider="volcengine">获取可用模型</button>
                  <button class="btn ghost tiny" type="button" data-action="ai-test" data-provider="volcengine">测试连接</button>
                </div>
                <div class="ai-hints">
                  <div class="form-hint" data-ai-hint="volcengine"></div>
                  <div class="form-hint" data-ai-models="volcengine"></div>
                </div>
              </details>

              <div class="ai-compat-group">
                <div class="ai-compat-head">
                  <div>
                    <h3>OpenAI 兼容服务商</h3>
                    <p>可添加多个并自定义名称</p>
                  </div>
                  <button class="btn ghost tiny" type="button" id="ai-compat-add">添加服务商</button>
                </div>
                <div id="ai-compat-list" class="ai-compat-list"></div>
              </div>
            </div>
          </section>
        </main>
      </section>

      <footer class="site-footer">
        <div class="footer-left">
          <span id="footer-year">©2025-2025</span>
          <a href="https://github.com/crazy0x70/CyberMonitor" target="_blank" rel="noreferrer">CyberMonitor</a>
        </div>
        <div class="footer-right">
          Powered by <a href="https://github.com/crazy0x70" target="_blank" rel="noreferrer">Crazy0x70</a>
          (<span id="footer-commit">--</span>)
        </div>
      </footer>
    </div>

    <script src="/assets/theme.js"></script>
    <script src="/assets/admin.js"></script>
  </body>
</html>
