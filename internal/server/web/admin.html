<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>CyberMonitor 管理后台</title>
    <link rel="icon" id="site-icon" />
    <link rel="stylesheet" href="/assets/styles.css" />
  </head>
  <body>
    <div class="bg-orb orb-a"></div>
    <div class="bg-orb orb-b"></div>
    <div class="bg-orb orb-c"></div>

    <div class="app admin">
      <header class="topbar">
        <div>
          <a class="brand brand-link" href="/">CyberMonitor</a>
          <div class="subtitle">管理后台</div>
        </div>
      </header>

      <section id="login-panel" class="panel login-panel">
        <div class="panel-head centered">
          <div>
            <h2>管理员登录</h2>
          </div>
        </div>
        <form id="login-form" class="form-grid">
          <label class="field">
            <span>用户名</span>
            <input class="input" type="text" name="username" autocomplete="username" required />
          </label>
          <label class="field">
            <span>密码</span>
            <input class="input" type="password" name="password" autocomplete="current-password" required />
          </label>
          <button class="btn" type="submit">登录</button>
          <div id="login-error" class="form-hint error"></div>
        </form>
      </section>

      <section id="admin-shell" class="admin-shell hidden">
        <aside class="side-nav">
          <button class="side-link active" type="button" data-section="settings">基础设置</button>
          <button class="side-link" type="button" data-section="groups">分组管理</button>
          <button class="side-link" type="button" data-section="tests">探测设置</button>
          <button class="side-link" type="button" data-section="agents">服务器管理</button>
          <button class="side-link" type="button" data-section="alerts">通知告警</button>
          <button class="side-link side-logout hidden" type="button" id="logout-link">退出登录</button>
        </aside>

        <main class="admin-main">
          <section class="panel" data-section="settings">
            <div class="panel-head">
              <div>
                <h2>基础设置</h2>
                <p class="panel-desc">修改后台路径与管理员账号，密码留空则不修改。</p>
              </div>
              <div class="panel-actions">
                <button class="btn small" id="save-settings-btn" type="button">保存</button>
                <div class="form-hint" id="settings-hint"></div>
              </div>
            </div>
            <div class="admin-grid">
              <label class="field">
                <span>后台路径</span>
                <input class="input" type="text" id="admin-path" placeholder="/随机路径" />
              </label>
              <label class="field">
                <span>管理员账号</span>
                <input class="input" type="text" id="admin-user" placeholder="admin" />
              </label>
              <label class="field">
                <span>新密码</span>
                <input class="input" type="password" id="admin-pass" placeholder="留空不修改" />
              </label>
              <label class="field">
                <span>Agent 对接地址</span>
                <input class="input" type="text" id="agent-endpoint" placeholder="https://agent.example.com" />
              </label>
              <label class="field">
                <span>站点 Title</span>
                <input class="input" type="text" id="site-title" placeholder="浏览器标题" />
              </label>
              <label class="field">
                <span>站点 Icon</span>
                <input class="input" type="text" id="site-icon-input" placeholder="图标 URL 或路径" />
              </label>
              <label class="field">
                <span>首页标题</span>
                <input class="input" type="text" id="home-title" placeholder="首页主标题" />
              </label>
              <label class="field">
                <span>首页副标题</span>
                <input class="input" type="text" id="home-subtitle" placeholder="首页副标题" />
              </label>
            </div>
          </section>

          <section class="panel hidden" data-section="groups">
            <div class="panel-head">
              <div>
                <h2>分组管理</h2>
                <p class="panel-desc">配置分组与标签，标签用于前台分组内展示。</p>
              </div>
              <div class="panel-actions">
                <button class="btn ghost small" id="add-group-btn" type="button">添加分组</button>
                <button class="btn small" id="save-group-btn" type="button">保存</button>
                <div class="form-hint" id="group-hint"></div>
              </div>
            </div>
            <div class="group-tree" id="group-tree"></div>
          </section>

          <section class="panel hidden" data-section="tests">
            <div class="panel-head">
              <div>
                <h2>探测设置</h2>
                <p class="panel-desc">统一维护 ICMP/TCP 目标与默认间隔，节点配置时直接选择。</p>
              </div>
              <div class="panel-actions">
                <button class="btn ghost small" id="add-test-btn" type="button">添加测试节点</button>
                <button class="btn small" id="save-tests-btn" type="button">保存</button>
                <div class="form-hint" id="catalog-hint"></div>
              </div>
            </div>
            <div class="test-catalog-list" id="test-catalog-list"></div>
          </section>

          <section class="panel hidden" data-section="agents">
            <div class="panel-head">
              <div>
                <h2>服务器管理</h2>
                <p class="panel-desc">配置别名、分组、地区与到期策略。</p>
              </div>
              <div class="panel-actions">
                <button class="btn ghost" id="refresh-btn" type="button">刷新</button>
              </div>
            </div>
            <div class="install-card">
              <div class="install-head">
                <h3>快速安装 Agent</h3>
                <p class="panel-desc">在目标服务器执行以下命令后按提示完成安装。</p>
              </div>
              <div class="install-tabs">
                <button class="install-tab active" type="button" data-install-tab="linux">Linux / macOS</button>
                <button class="install-tab" type="button" data-install-tab="windows">Windows</button>
              </div>
              <div class="install-pane active" data-install-pane="linux">
                <pre class="install-code" id="install-linux"></pre>
              </div>
              <div class="install-pane" data-install-pane="windows">
                <pre class="install-code" id="install-windows"></pre>
              </div>
            </div>
            <div id="node-list" class="node-admin-list"></div>
            <div id="admin-empty" class="empty hidden">
              <h2>暂无节点</h2>
              <p>请先启动 Agent 并完成上报。</p>
            </div>
          </section>

          <section class="panel hidden" data-section="alerts">
            <div class="panel-head">
              <div>
                <h2>通知告警</h2>
                <p class="panel-desc">配置飞书或 Telegram 机器人，服务器离线后自动推送提醒。</p>
              </div>
              <div class="panel-actions">
                <button class="btn small" id="save-alerts-btn" type="button">保存</button>
                <button class="btn ghost" id="test-alerts-btn" type="button">测试</button>
                <div class="form-hint" id="alerts-hint"></div>
              </div>
            </div>
            <div class="admin-grid">
              <label class="field span-full">
                <span>飞书 Webhook</span>
                <input class="input" type="text" id="alert-webhook" placeholder="https://open.feishu.cn/open-apis/bot/v2/hook/..." />
              </label>
              <label class="field span-full">
                <span>Telegram Bot Token</span>
                <input class="input" type="text" id="alert-telegram-token" placeholder="123456:ABC-DEF..." />
                <div class="form-hint">启用 Telegram 告警需同时填写 Token 与用户 ID</div>
              </label>
              <label class="field">
                <span>Telegram 用户 ID（逗号分隔）</span>
                <input class="input" type="text" id="alert-telegram-user-id" placeholder="123456789,987654321" />
              </label>
              <label class="field">
                <span>离线时长(分钟)</span>
                <input class="input" type="number" id="alert-offline-minutes" min="1" step="1" placeholder="默认 5" />
              </label>
              <div class="field span-full">
                <span>监测说明</span>
                <div class="form-hint">离线告警开关请在「服务器管理」中按节点设置</div>
              </div>
            </div>
          </section>
        </main>
      </section>

      <footer class="site-footer">
        <div class="footer-left">
          <span id="footer-year">©2025-2025</span>
          <a href="https://github.com/crazy0x70/CyberMonitor" target="_blank" rel="noreferrer">CyberMonitor</a>
        </div>
        <div class="footer-right">
          Powered by <a href="https://github.com/crazy0x70" target="_blank" rel="noreferrer">Crazy0x70</a>
          (<span id="footer-commit">--</span>)
        </div>
      </footer>
    </div>

    <script src="/assets/admin.js"></script>
  </body>
</html>
